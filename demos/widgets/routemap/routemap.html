<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Routemap Demo - Web UI Framework Demos</title>
	<link rel="stylesheet" href="../../../jqm/css/themes/default/jquery.mobile.css" />
	<link rel="stylesheet" href="../../../css/themes/default/web-ui-fw.css" />
	<link rel="stylesheet" href="../../../jqm/demos/_assets/css/jqm-demos.css">
	<style>
		.ui-station-selected {
			stroke: red;
			stroke-width: 6;
		}
		.ui-station-text-selected {
			font-size: 1.5em;
		}
		.ui-line-selected {
			stroke-width: 8;
		}
	</style>
	<script src="../../../jqm/js/jquery.js"></script>
	<script src="../../../jqm/js/"></script>
	<script src="../../../js/"></script>
	<script src="../../_assets/js/"></script>
	<script>
		$( document ).on( "routemapcreate", function ( e ) {
			widget = $( "#routemapTest" );
			widget.on( "select", function( e, id ) {
				var target = e.target;
				if ( id === undefined ) {
					unselect( "ui-station-selected", "ui-station-text-selected", "ui-line-selected" );
				} else if ( target.classList.contains( "ui-station" ) ) {
					var	name = widget.routemap( "getNameById", id );
					unselect( "ui-station-selected", "ui-station-text-selected" );
					target.classList.add( "ui-station-selected" );
					widget.find( ".ui-station-text" ).each( function () {
						if ( $( this ).text() === name ) {
							this.classList.add( "ui-station-text-selected");
						}
					} );
				} else if ( target.classList.contains( "ui-line" ) ) {
					unselect( "ui-line-selected" );
					widget.find( ".ui-id-" + id ).each( function () {
						this.classList.add( "ui-line-selected" );
					} );
				}
			});

			$( "#shortestWay" ).on( "click", function () {
				var startId = widget.routemap( "getIdsByName", "station21" ),
					endId = widget.routemap( "getIdsByName", "station7(ex)" ),
					path;

				unselect( "ui-station-selected", "ui-station-text-selected", "ui-line-selected" );
				path = widget.routemap( "shortestRoute", startId[0], endId[0] );
				alert( path );
				widget.routemap( "highlight", path );
			});

			$( "#minimumTransfers" ).on( "click", function () {
				var startId = widget.routemap( "getIdsByName", "station21" ),
					endId = widget.routemap( "getIdsByName", "station7(ex)" ),
					path;
				console.log(endId);
				path = widget.routemap( "minimumTransfers", startId[0], endId[0] );
				alert( path );
				widget.routemap( "highlight", path );
			});

			$( "#clearWay" ).on( "click", function () {
				widget.routemap( "dishighlight" );
			});

			$( "#getIdsByName" ).on( "click", function () {
				alert( widget.routemap( "getIdsByName", "station5(ex)" ) );
			});

			$( "#getNameById" ).on( "click", function () {
				alert( widget.routemap( "getNameById", "5" ) );
			});

			$( "#highlight" ).on( "click", function () {
				var path = ["3", "4", "33", "44", "45" ];
				widget.routemap( "highlight", path );
			});

			$( "#dishighlight" ).on( "click", function () {
				var path = ["3", "4", "33", "44", "45" ];
				widget.routemap( "dishighlight", path );
			});

			function unselect( ) {
				var i, classes = arguments;
				if ( !classes || classes.length === 0 ) {
					return false;
				}
				for ( i = 0; i < classes.length; i++ ){
					widget.find ( "."+ classes[i] ).each ( function () {
						this.classList.remove( classes[i] );
					})
				}
			}
		});
	</script>


</head>
<body>
	<div data-role="page" id="routemap" data-dom-cache="true">
		<div data-role="header" data-position="fixed">
			<h1>Routemap Demo - Web UI Framework Demos</h1>
			<a href="../../" data-icon="home" data-iconpos="notext" data-ajax="false">Home</a>
		</div> <!--/header -->
		<div data-role="content">
			<div class="content-primary">
				<h3>Routemap</h3>
				<div data-demo-html="true" data-demo-js="true">
					<div id="routemapTest"
						data-role="routemap"
						data-db="routemap_data.json"
						data-unit="60">
					</div>
					<div>
						<button id="shortestWay">shortestWay : station21 > station7</button>
						<button id="minimumTransfers">minimumTransfers : station21 > station7</button>
						<button id="clearWay">Clear</button>
						<button id="getIdsByName">getIdsByName : "station5(ex)"</button>
						<button id="getNameById">getNameById : "5"</button>
						<button id="highlight">highlight : station3 > station45 </button>
						<button id="dishighlight">dishighlight : station3 > station45 </button>
					</div>
				</div>
			</div>
		</div> <!--/content -->
	</div>
</body>
</html>
